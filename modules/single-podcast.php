<?php while (have_posts()) : the_post() ?>
	<?php $podcast = new Sleek\PostTypes\Podcast; ?>

	<section id="single-<?php echo get_post_type() ?>" class="container">

		<?php if ($image = $podcast->getImage($post->ID, 600, 50)) : ?>
			<figure>
				<img width="600" height="600" src="<?php echo $image ?>" alt="<?php the_title() ?>">
			</figure>
		<?php endif ?>

		<header>
			<h1><?php the_title() ?></h1>

			<div data-excerpt>
				<?php the_content() ?>
			</div>

			<dl>
				<div>
					<dt><?php _e('Total episodes', 'sleek') ?>:</dt>
					<dd><?php echo $podcast->getEpisodeCount($post->ID) ?></dd>
				</div>

				<div>
					<dt><?php _e('Latest release', 'sleek') ?>:</dt>
					<dd><?php echo date_i18n(get_option('date_format'), strtotime(get_post_meta($post->ID, 'release_date', true))); ?></dd>
				</div>

				<div>
					<dt><?php _e('Podcast author', 'sleek') ?>:</dt>
					<dd><?php echo get_post_meta($post->ID, 'artist', true); ?></dd>
				</div>
			</dl>

			<a href="<?php echo get_post_meta($post->ID, 'itunes_link', true) ?>">
				<svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="149.1049" height="26.7547"><path fill="#FFF" d="M38.1928 20.4031h-4.7334l-1.1367 3.3564h-2.0049l4.4834-12.418h2.083l4.4834 12.418h-2.0391l-1.1357-3.3564zm-4.2432-1.5488h3.752L35.852 13.407h-.0518l-1.8506 5.4473zm17.1006.3789c0 2.8135-1.5059 4.6211-3.7783 4.6211-1.29 0-2.3145-.5771-2.8486-1.584h-.043v4.4844h-1.8584V14.7058h1.7988v1.5059h.0342c.5166-.9717 1.6182-1.6006 2.8828-1.6006 2.2979 0 3.8125 1.8164 3.8125 4.6221zm-1.9101 0c0-1.833-.9473-3.0381-2.3926-3.0381-1.4199 0-2.375 1.2305-2.375 3.0381 0 1.8242.9551 3.0459 2.375 3.0459 1.4453 0 2.3926-1.1963 2.3926-3.0459zm11.875 0c0 2.8135-1.5059 4.6211-3.7783 4.6211-1.29 0-2.3145-.5771-2.8486-1.584h-.043v4.4844h-1.8584V14.7058h1.7988v1.5059h.0342c.5166-.9717 1.6182-1.6006 2.8828-1.6006 2.2978 0 3.8125 1.8164 3.8125 4.6221zm-1.9102 0c0-1.833-.9473-3.0381-2.3926-3.0381-1.4199 0-2.375 1.2305-2.375 3.0381 0 1.8242.9551 3.0459 2.375 3.0459 1.4453 0 2.3926-1.1963 2.3926-3.0459zm3.415-7.8916h1.8594v12.418h-1.8594v-12.418zm11.5352 9.7588c-.25 1.6436-1.8506 2.7715-3.8984 2.7715-2.6338 0-4.2686-1.7646-4.2686-4.5957 0-2.8398 1.6436-4.6816 4.1904-4.6816 2.5049 0 4.0801 1.7207 4.0801 4.4658v.6367h-6.3945v.1123c0 1.5488.9727 2.5645 2.4355 2.5645 1.0322 0 1.8418-.4902 2.0908-1.2734h1.7647zm-6.2822-2.7022h4.5264c-.043-1.3857-.9297-2.2979-2.2207-2.2979-1.2823.0001-2.211.9298-2.3057 2.2979zm16.2842-7.0566c2.4092 0 4.0879 1.6611 4.0879 4.0791 0 2.4268-1.7129 4.0957-4.1484 4.0957h-2.668v4.2432h-1.9277v-12.418h4.6562zm-2.7286 6.5576h2.2119c1.6777 0 2.6328-.9043 2.6328-2.4697 0-1.5664-.9551-2.4619-2.624-2.4619h-2.2207v4.9316zm7.4952 1.334c0-2.8486 1.6777-4.6387 4.2939-4.6387 2.625 0 4.2949 1.79 4.2949 4.6387 0 2.8564-1.6611 4.6387-4.2949 4.6387-2.6328-.0001-4.2939-1.7823-4.2939-4.6387zm6.6953 0c0-1.9541-.8955-3.1074-2.4014-3.1074s-2.4014 1.1621-2.4014 3.1074c0 1.9619.8955 3.1064 2.4014 3.1064s2.4014-1.1445 2.4014-3.1064zm3.1982 0c0-2.7969 1.54-4.6221 3.7861-4.6221 1.2998 0 2.3242.6025 2.8398 1.6006h.0352v-4.8701h1.8672v12.418h-1.8076v-1.54h-.0342c-.5332 1.0322-1.5664 1.6348-2.8828 1.6348-2.2637-.0001-3.8037-1.8243-3.8037-4.6212zm1.9014 0c0 1.8584.9473 3.0459 2.3926 3.0459 1.4287 0 2.3838-1.2051 2.3838-3.0459 0-1.8252-.9551-3.0381-2.3838-3.0381-1.4454 0-2.3926 1.1963-2.3926 3.0381zm14.5351-1.4121c-.1631-.9551-.9121-1.6689-2.1338-1.6689-1.4287 0-2.376 1.1963-2.376 3.0811 0 1.9277.9561 3.0889 2.3926 3.0889 1.1533 0 1.9111-.5762 2.1172-1.626h1.79c-.2061 1.9014-1.7295 3.1758-3.9238 3.1758-2.582 0-4.2686-1.7646-4.2686-4.6387 0-2.8145 1.6865-4.6387 4.251-4.6387 2.3232 0 3.7695 1.4629 3.9248 3.2266h-1.7734zm2.9287 3.3652c0-1.583 1.2129-2.5391 3.3643-2.668l2.4785-.1377v-.6885c0-1.0068-.6621-1.5752-1.7891-1.5752-1.0332 0-1.7559.4912-1.9023 1.2744h-1.7383c.0518-1.6357 1.5742-2.7969 3.6914-2.7969 2.1602 0 3.5889 1.1787 3.5889 2.96v6.2051h-1.7812v-1.4893h-.043c-.5254 1.0068-1.6699 1.6445-2.8574 1.6445-1.7725.0001-3.0118-1.1014-3.0118-2.7284zm5.8428-.8174v-.6973l-2.2285.1377c-1.1104.0693-1.7383.5508-1.7383 1.3252 0 .792.6543 1.3086 1.6523 1.3086 1.2999 0 2.3145-.8955 2.3145-2.0742zm7.0381-5.7656c2.0059 0 3.4424 1.1094 3.4854 2.71h-1.7471c-.0771-.7998-.7568-1.29-1.79-1.29-1.0068 0-1.6777.4639-1.6777 1.1699 0 .542.4473.9033 1.3857 1.1357l1.5234.3535c1.8242.4385 2.5127 1.1094 2.5127 2.4355 0 1.6348-1.5488 2.7539-3.7607 2.7539-2.1348 0-3.5713-1.0938-3.709-2.7461h1.8408c.1299.8691.8262 1.334 1.9541 1.334 1.1104 0 1.8076-.4561 1.8076-1.1787 0-.5596-.3447-.8604-1.291-1.1016l-1.6182-.3955c-1.6357-.3965-2.4619-1.2314-2.4619-2.4873 0-1.6005 1.4375-2.6933 3.5459-2.6933zm7.7305-2.04v2.1426h1.7217v1.4717h-1.7217v4.9912c0 .7754.3447 1.1367 1.1016 1.1367.1895 0 .4912-.0264.6113-.043v1.4629c-.2061.0518-.6191.0859-1.0322.0859-1.833 0-2.5479-.6885-2.5479-2.4443v-5.1895h-1.3164v-1.4717h1.3164v-2.1426h1.8672zm6.7187 2.04c2.0059 0 3.4424 1.1094 3.4854 2.71h-1.7471c-.0771-.7998-.7568-1.29-1.79-1.29-1.0068 0-1.6777.4639-1.6777 1.1699 0 .542.4473.9033 1.3857 1.1357l1.5234.3535c1.8242.4385 2.5127 1.1094 2.5127 2.4355 0 1.6348-1.5488 2.7539-3.7607 2.7539-2.1348 0-3.5713-1.0938-3.709-2.7461h1.8408c.1299.8691.8262 1.334 1.9541 1.334 1.1104 0 1.8076-.4561 1.8076-1.1787 0-.5596-.3447-.8604-1.291-1.1016l-1.6182-.3955c-1.6357-.3965-2.4619-1.2314-2.4619-2.4873 0-1.6005 1.4375-2.6933 3.5459-2.6933zM24.6653 21.8098c-.2446.6213-.809 1.4961-1.6094 2.1124-.4621.3559-1.0138.6961-1.7716.9206-.8078.2394-1.8028.3203-3.0412.3203H6.9198c-1.2383 0-2.2333-.0809-3.0412-.3203-.7578-.2245-1.3094-.5647-1.7716-.9206-.8003-.6163-1.3648-1.491-1.6094-2.1124C.005 20.558 0 19.1376 0 18.2432V6.9198c0-.8944.005-2.3148.4977-3.5666.2446-.6213.809-1.4961 1.6094-2.1123C2.5692.885 3.1209.5448 3.8786.3203 4.6865.0809 5.6815 0 6.9198 0h11.3234c1.2383 0 2.2333.0809 3.0412.3203.7578.2245 1.3094.5648 1.7716.9206.8003.6163 1.3648 1.491 1.6094 2.1123.4926 1.2518.4976 2.6722.4976 3.5666v11.3233c0 .8945-.005 2.3149-.4977 3.5667zm-10.2589-7.3466c-.3776-.3983-1.0408-.6537-1.8237-.6537-.783 0-1.4462.2554-1.8238.6537-.197.2079-.3012.4211-.334.7247-.0636.5879-.0279 1.0941.041 1.9034.0656.7712.1902 1.7996.3528 2.847.1157.7454.2098 1.1477.2953 1.4358.1388.4669.6575.8752 1.4687.8752.8111 0 1.3298-.4084 1.4686-.8752.0856-.2881.1796-.6904.2953-1.4358.1626-1.0474.2872-2.0758.3528-2.847.0689-.8094.1046-1.3156.041-1.9034-.0328-.3036-.137-.5168-.334-.7247zm-3.8811-3.5473c0 1.1374.922 2.0594 2.0593 2.0594 1.1374 0 2.0594-.922 2.0594-2.0594 0-1.1373-.922-2.0593-2.0594-2.0593-1.1373 0-2.0593.922-2.0593 2.0593zm2.0338-8.127c-4.8163.0137-8.7628 3.921-8.8224 8.737-.0484 3.9013 2.442 7.2385 5.9195 8.4617.0844.0297.1701-.0404.1568-.1289-.0456-.3029-.0886-.6073-.1281-.9066-.014-.1058-.0814-.197-.1791-.2397-2.7486-1.2008-4.6679-3.9574-4.6371-7.1505.0404-4.1904 3.4622-7.6066 7.6526-7.6405 4.2839-.0346 7.78 3.4402 7.78 7.7162 0 3.1611-1.9109 5.8839-4.6381 7.0751-.0977.0427-.1647.1342-.1786.2399-.0395.2992-.0825.6035-.128.9061-.0134.0885.0723.1586.1567.129 3.4443-1.2115 5.9202-4.4968 5.9202-8.35-.0002-4.8879-3.9835-8.8627-8.8744-8.8488zm-.1599 4.0595c2.7303-.1057 4.9851 2.0847 4.9851 4.7919 0 1.3768-.5833 2.6198-1.5156 3.4952-.0791.0742-.1216.1796-.1155.2879.0186.3293.0118.6493-.0101 1.0107-.0059.0963.1021.1578.1818.1035 1.5634-1.0684 2.5917-2.8649 2.5917-4.8973 0-3.3464-2.7874-6.0541-6.1623-5.9233-3.1364.1216-5.6527 2.7075-5.6929 5.8461-.0264 2.0642 1.0082 3.8929 2.5917 4.9747.0795.0543.1872-.0073.1813-.1035-.022-.3616-.0287-.6816-.0102-1.0109.0061-.108-.0362-.2134-.1152-.2876-.9614-.9026-1.5518-2.1961-1.5142-3.6241.0662-2.5131 2.0923-4.566 4.6044-4.6633zm22.2545.6885h-3.7769V1.4822h.9399v5.1904h2.8369v.8643zm.6988 1.6367v-.7764c.0713.0127.21.0166.2935.0166.4282 0 .6714-.1758.8267-.6377l.0673-.2226-1.6533-4.5859h.9819l1.1455 3.6299h.0713l1.1416-3.6299h.9565l-1.7036 4.7588c-.3901 1.1113-.8223 1.4688-1.7539 1.4688-.0757-.0001-.2896-.0089-.3735-.0216zm6.4218-6.2939c1.0278 0 1.6992.4785 1.7876 1.2842h-.8643c-.084-.3359-.4116-.5498-.9233-.5498-.5034 0-.8853.2393-.8853.5957 0 .2725.2305.4443.7256.5576l.7598.1768c.8687.2012 1.2754.5742 1.2754 1.2461 0 .8604-.8013 1.4346-1.8921 1.4346-1.0869 0-1.7964-.4902-1.876-1.3008h.9023c.1133.3525.4487.5713.9946.5713.562 0 .9604-.252.9604-.6172 0-.2725-.2139-.4492-.6709-.5576l-.7974-.1846c-.8687-.2061-1.2715-.5967-1.2715-1.2764.0002-.8096.7429-1.3799 1.7751-1.3799zm4.6724 0c1.0278 0 1.6992.4785 1.7876 1.2842H47.37c-.084-.3359-.4116-.5498-.9233-.5498-.5034 0-.8853.2393-.8853.5957 0 .2725.2305.4443.7256.5576l.7598.1768c.8687.2012 1.2754.5742 1.2754 1.2461 0 .8604-.8013 1.4346-1.8921 1.4346-1.0869 0-1.7964-.4902-1.876-1.3008h.9023c.1133.3525.4487.5713.9946.5713.562 0 .9609-.252.9609-.6172 0-.2725-.2144-.4492-.6719-.5576l-.7969-.1846c-.8687-.2061-1.2715-.5967-1.2715-1.2764.0002-.8096.7429-1.3799 1.7751-1.3799zm3.0864.0879h.8687v.7256h.0669c.2227-.5078.6758-.8135 1.3638-.8135 1.0195 0 1.582.6123 1.582 1.6992v2.958h-.9023V4.8054c0-.7344-.3188-1.0996-.9858-1.0996-.6675 0-1.0913.4453-1.0913 1.1582v2.6729h-.9019V2.9676zm5.0117 3.2773c0-.8223.6123-1.2969 1.6992-1.3643l1.2378-.0713v-.3945c0-.4824-.3188-.7549-.9355-.7549-.5034 0-.8521.1846-.9526.5078h-.8726c.0923-.7852.8306-1.2881 1.8672-1.2881 1.1455 0 1.7915.5703 1.7915 1.5352v3.1221h-.8682v-.6416h-.0713c-.2729.457-.7725.7178-1.3726.7178-.8808 0-1.5229-.5332-1.5229-1.3682zm2.9371-.3906v-.3819l-1.1157.0713c-.6299.042-.915.2559-.915.6592 0 .4111.3569.6504.8477.6504.6795 0 1.183-.4326 1.183-.999zm9.0488-.6045c0 1.4521-.7339 2.3633-1.8882 2.3633-.6504 0-1.1665-.2861-1.4058-.7686h-.0713v2.2119h-.9019V2.9676h.8687v.7549h.0669c.2769-.5195.814-.8301 1.4351-.8301 1.1626 0 1.8965.9062 1.8965 2.3574zm-.9273 0c0-.9648-.457-1.5479-1.2212-1.5479-.7593 0-1.2334.5957-1.2334 1.5527 0 .9521.4741 1.5479 1.2295 1.5479.7681 0 1.2251-.583 1.2251-1.5527zm1.8731.9951c0-.8223.6123-1.2969 1.6992-1.3643l1.2378-.0713v-.3945c0-.4824-.3188-.7549-.9355-.7549-.5034 0-.8521.1846-.9526.5078h-.8726c.0923-.7852.8306-1.2881 1.8672-1.2881 1.1455 0 1.7915.5703 1.7915 1.5352v3.1221h-.8682v-.6416h-.0713c-.2729.457-.7725.7178-1.3726.7178-.8808 0-1.5229-.5332-1.5229-1.3682zm2.937-.3906v-.3819l-1.1157.0713c-.6299.042-.915.2559-.915.6592 0 .4111.3569.6504.8477.6504.6796 0 1.183-.4326 1.183-.999zm-1.8882-4.4942c0-.5576.4409-.9775.9946-.9775s.9946.4199.9946.9775c0 .5586-.4409.9824-.9946.9824s-.9946-.4238-.9946-.9824zm1.4815 0c0-.2725-.21-.4785-.4868-.4785-.2812 0-.4868.2061-.4868.4785 0 .2773.2056.4824.4868.4824s.4868-.205.4868-.4824z"/></svg>
			</a>

			<?php if (($terms = get_the_terms($post->ID, (get_post_type() === 'post' ? 'category' : get_post_type() . '_category'))) and !is_wp_error($terms)) : ?>
				<ul>
					<?php echo implode('', array_map(function ($term) {
						return '<li><a href="' . get_term_link($term) . '" class="button button--small">' . $term->name . '</a></li>';
					}, $terms)) ?>
				</ul>
			<?php endif ?>
		</header>

	</section>
<?php endwhile ?>

<section id="single-podcast-episodes" class="container">
	<?php
		global $wp_query;

		$paged = get_query_var('paged') ? get_query_var('paged') : 1;
		$original_query = $wp_query;

		$posts = $wp_query = new WP_Query([
			'post_type' => 'episode',
			'post_parent' => $post->ID,
			'posts_per_page' => 10,
			'paged' => $paged
		]);
	?>

	<?php if ($posts->have_posts()) : ?>
		<div class="grid" data-infinite-scroll='{"path": "#pagination .next", "hideNav": "#pagination", "append": ".post--episode", "history": false, "loadOnScroll": true, "status": ".page-load-status"}'>
			<?php  while ($posts->have_posts()) : $posts->the_post(); ?>
				<?php get_template_part('modules/post', get_post_type()) ?>
			<?php endwhile ?>
		</div>

		<div class="page-load-status">
			<p class="infinite-scroll-request icon-spinner"></p>
		</div>

		<?php the_posts_pagination() ?>

		<?php $wp_query = $original_query; wp_reset_query() ?>
	<?php endif ?>
</section>


